# База данных (Database)

## Общая информация

Для хранения и анализа статистических данных по потреблению электроэнергии используется база данных PostgreSQL.  
Данные загружаются с сайта [АТС (Администратор торговой системы)](https://www.atsenergo.ru/) в формате Excel, после чего импортируются в PostgreSQL с помощью скрипта `pg_dump.txt`.

Визуальная схема структуры базы данных показана ниже:

![Структура таблицы базы данных](ИИТИАД.drawio.png) 

---

## Импорт данных

Импорт базы данных производится через скрипт `pg_dump.txt` (ранее `pg_dump.tar`), содержащий SQL-команды для восстановления структуры и наполнения таблиц.

**Основные этапы:**
1. Скачивание Excel-файлов при помощи `fetch_data.py`.
2. Конвертация данных в подходящий формат (CSV/SQL).
3. Импорт в PostgreSQL при помощи `pgAdmin4` через файл `pg_dump.txt`.

После загрузки данные становятся доступны для анализа и визуализации во фронтенде (`index.html`).

---

## Основная таблица: `public.elec_reports`

Таблица содержит агрегированные данные о планах, фактических показателях и ценах на электроэнергию по регионам России.

### Структура таблицы

| Поле | Описание |
|------|-----------|
| **id** | Уникальный идентификатор записи |
| **region** | Субъект РФ |
| **timestamp** | Дата и время отчёта |
| **plan_GES** | План генерации гидроэлектростанций |
| **plan_AES** | План генерации атомных электростанций |
| **plan_TES** | План генерации тепловых электростанций |
| **plan_SES** | План генерации солнечных электростанций |
| **plan_VES** | План генерации ветровых электростанций |
| **plan_other** | План генерации прочих ВИЭ |
| **plan_consumption** | План потребления электроэнергии |
| **plan_export** | План экспорта |
| **plan_import** | План импорта |
| **price_buy** | Средняя цена покупки |
| **price_sell** | Средняя цена продажи |
| **full_plan** | Полный план энергопроизводства |
| **technmin_GES** / **technmax_GES** | Минимальная/максимальная техническая мощность ГЭС |
| **technmin_AES** / **technmax_AES** | Минимальная/максимальная мощность АЭС |
| **technmin_TES** / **technmax_TES** | Минимальная/максимальная мощность ТЭС |
| **technmin_SES** / **technmax_SES** | Минимальная/максимальная мощность СЭС |
| **technmin_VES** / **technmax_VES** | Минимальная/максимальная мощность ВЭС |
| **technmin_other** / **technmax_other** | Прочие ВИЭ (мин/макс мощности) |
| **plan_GES**, **plan_AES**, ... | Плановые показатели для каждого типа электростанции |

---

## Назначение ключевых файлов

| Файл              | Назначение                                                                                                 |
| ----------------- | ---------------------------------------------------------------------------------------------------------- |
| **fetch_data.py** | Скрипт для автоматического скачивания Excel-файлов с сайта АТС и подготовки данных к импорту в PostgreSQL. |
| **pg_dump.txt**   | SQL-дамп базы данных с готовыми таблицами и данными. Используется для импорта в pgAdmin4.                  |
| **index.html**    | Визуальная часть, отображающая данные, извлечённые из базы. Включает таблицы, графики и фильтры.           |
| **database.md**   | Раздел документации, описывающий структуру, назначение и принципы работы базы данных проекта.              |

---

## Связи таблиц и логика использования

В текущей версии проекта используется **одна основная таблица `public.elec_reports`**, которая содержит все ключевые данные.  
На следующих этапах возможно расширение базы и добавление вспомогательных таблиц, например:
- `regions` — справочник регионов;
- `prices` — таблица детализированных ценовых данных;
- `plans` — архив планов и прогнозов по дням.

Все операции выборки и анализа данных происходят именно через `public.elec_reports`.

---

## Использование базы данных

- Импорт осуществляется из файла `pg_dump.txt` с помощью pgAdmin4.  
- Скрипт `fetch_data.py` автоматически скачивает актуальные Excel-файлы с сайта АТС и подготавливает их для загрузки.
- Все данные сохраняются в таблицу `public.elec_reports`, после чего доступны для анализа и визуализации на фронтенде (`index.html`).

---

## Взаимодействие с Backend

Backend использует SQL-запросы для выборки агрегированных данных, статистики и построения отчётов.  
Эти данные передаются на фронтенд для отображения таблиц и графиков в визуальной части веб-сервиса.

---

## Использование во Frontend

Фронтенд визуализирует данные из базы данных в виде интерактивных таблиц и графиков.
Для этого используется файл index.html, где данные отображаются по регионам и видам электростанций.

---
